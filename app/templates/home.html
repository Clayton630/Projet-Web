<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <!-- Lien vers Google Fonts pour la police "Inter" -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <title>Accueil</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- CSS de la bibliothèque de cartes Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- Bootstrap 5 pour la grille et les boutons + Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <!-- Feuille de style custom : effets glass, neumorph, etc -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
</head>
<body>
    <!-- ----------------- HEADER ----------------- -->
    <header class="container-fluid py-3">
        <div class="row align-items-center">
            <!-- Bouton Dashboard Admin (visible uniquement pour les admins connectés) -->
            <div class="col-4 dashboard-col text-start" style="padding-left:2 !important;">
                {% if current_user.is_authenticated and current_user.isadmin %}
                    <a href="{{ url_for('main.dashboard') }}" class="vo-btn-action vo-btn-dashboard ms-2" style="margin-left:0 !important;">
                        <i class="bi bi-bar-chart"></i><span class="btn-text"> Dashboard Admin</span>
                    </a>
                {% endif %}
            </div>
            <!-- Colonne centrale vide (pour centrage, responsive, etc) -->
            <div class="col-4 text-center"></div>
            <!-- Bouton Se Déconnecter (toujours affiché si connecté) -->
            <div class="col-4 logout-col text-end" style="padding-right:2 !important;">
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('main.logout') }}" class="vo-btn vo-btn-logout me-2" style="margin-right:0 !important;">
                        <i class="bi bi-box-arrow-right"></i><span class="btn-text"> Se déconnecter</span>
                    </a>
                {% else %}
                    <a href="{{ url_for('main.login') }}" class="vo-btn vo-btn-logout me-2" style="margin-right:0 !important;">
                        <i class="bi bi-box-arrow-in-right"></i><span class="btn-text"> Se connecter</span>
                    </a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- ----------------- MAIN CONTENU ----------------- -->
    <main class="container d-flex flex-column align-items-center vo-main">
        <!-- Titre d’accueil personnalisé -->
        <h1 class="vo-title text-center mb-4">Bienvenue {{ current_user.nom }}</h1>
        
        <!-- BARRE DE RECHERCHE + SELECTEUR CATEGORIE -->
        <div class="search-row mb-4 w-100">
            <!-- Zone recherche + autocomplete -->
            <div class="searchbar-center mb-2 mb-lg-0">
                <div class="search-wrapper">
                    <!-- Icône loupe (affichée à gauche de l’input) -->
                    <span class="search-icon" id="searchIcon" aria-hidden="true">🔍</span>
                    <!-- Champ de recherche établissements -->
                    <input id="searchInput" type="text" placeholder="   Rechercher un établissement" autocomplete="off" aria-label="Rechercher un établissement">
                </div>
                <!-- Suggestions (affichées en live en-dessous de l’input via JS) -->
                <div id="autocomplete-list" class="autocomplete-items"></div>
            </div>
            <!-- Selecteur de catégorie (pour filtrer les établissements sur la carte) -->
            <div class="select-inline">
                <div class="select-wrapper">
                    <select id="categorySelect" class="form-select vo-input" aria-label="Catégories">
                        <option value="">Catégories</option>
                        {% for cat in categories %}
                            <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        
        <!-- ----------- LA CARTE INTERACTIVE ----------- -->
        <div id="map" class="vo-map mb-4" role="region" aria-label="Carte des établissements"></div>
    </main>

    <!-- --------- PANEL LATÉRAL AJAX (détails établissement) --------- -->
    <aside id="side-panel" class="vo-panel" aria-modal="true" tabindex="-1">
        <div id="side-panel-content" class="vo-panel-content">
            <!-- Bouton fermeture panneau latéral -->
            <button id="close-panel" class="vo-panel-close" type="button" aria-label="Fermer le panneau latéral">
                <i class="bi bi-arrow-left"></i>
            </button>
            <!-- Contenu HTML chargé en AJAX ici (fiche_etablissement_panel.html) -->
        </div>
    </aside>

    <!-- ----------------- JS/LOGIQUE ----------------- -->
    <!-- Leaflet pour la carte -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- Initialisation variable Python envoyée au JS -->
    <script>
        var etablissements = {{ etablissements|tojson }};
    </script>
    <!-- Script principal maison (fonctionnalités carte, recherche, etc) -->
    <script src="{{ url_for('static', filename='js/home.js') }}"></script>
</body>
</html>